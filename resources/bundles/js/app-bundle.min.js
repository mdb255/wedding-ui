(function() {
  'use strict';

  angular.module('weddingApp', [
    'ngRoute',
    'ngAnimate',
    'ui.bootstrap',
    'appConfig',
    'LocalStorageModule'
  ]).
    run(['$rootScope', '$location', '$log', function($rootScope, $location, $log) {
      // Watch the URL location to update the active tab on the navbar
      var path = function() { return $location.path(); };
      $rootScope.$watch(path, function(newVal, oldVal) {
        $rootScope.activeTab = newVal;
        $log.debug("ActiveTab: " + $rootScope.activeTab);
      });
    }]);

})();

/**
 * Created by Mike on 11/8/2015.
 */

(function() {
  'use strict';

  angular.
    module('weddingApp').
    config(['$routeProvider', function($routeProvider) {
      $routeProvider
        .when('/rsvp', {
          templateUrl: '/wedding-app/components/rsvp/rsvp.html',
          controller: 'RsvpCtrl'
        })
        .when('/hotels', {
          templateUrl: '/wedding-app/components/hotels/hotels.html',
          controller: 'HotelsCtrl'
        })
        .when('/registry', {
          templateUrl: '/wedding-app/components/registry/registry.html',
          controller: 'RegistryCtrl'
        })
        .when('/home', {
          templateUrl: '/wedding-app/components/home/home.html',
          controller: 'HomeCtrl'
        })
        .when('/venue', {
          templateUrl: '/wedding-app/components/venue/venue.html',
          controller: 'VenueCtrl'
        })
        .when('/cart', {
          templateUrl: '/wedding-app/components/cart/cart.html',
          controller: 'CartCtrl',
          // TODO Switch the rest of the controllers to use this "controllerAs vm" syntax
          controllerAs: 'vm'
        });
      $routeProvider.otherwise({redirectTo: '/home'});
    }]);
})();

/**
 * Created by Mike on 5/4/2015.
 */

(function() {
  'use strict';

  angular.module('appConfig',[])
    .constant('appConfig',
    {
      'apiUrl': 'http://localhost:8080/wedding-ws/v1',
      'webRootPath': '/src/wedding-website/app/'
    });
})();

/**
 * Created by Mike on 5/25/2015.
 */

(function() {
  'use strict';

  angular.module('adminApp', ['appConfig']);

  angular
    .module('adminApp')
    .controller('AdminCtrl', AdminCtrl);

  AdminCtrl.$inject = ['$scope', '$log', '$http', 'appConfig'];

  function AdminCtrl($scope, $log, $http, appConfig) {
    $http.get(appConfig.apiUrl + '/rsvps').success(function(data) {
      $log.debug("data: " + JSON.stringify(data));

      $scope.rsvps = data;
    });
  }
})();

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .controller('CartCtrl', CartCtrl);

  CartCtrl.$inject = ['$scope', '$log', '$window', '$modal', 'cartSvc'];

  function CartCtrl($scope, $log, $window, $modal, cartSvc) {
    $window.scrollTo(0, 0);

    var vm = this;
    initialize();

    vm.removeCartItem = removeCartItem;
    vm.checkout = checkout;

    function removeCartItem(itemId) {
      var newCartItems = _.filter(vm.cart.items, function(id) { return id.itemId !== itemId; });
      cartSvc.saveCartItems(newCartItems);
      $log.debug("Removed item with id=" + itemId);
    }

    function checkout() {
      var modalInstance = $modal.open({
        templateUrl: 'checkout.html',
        controller: 'CheckoutModalCtrl',
        backdrop: 'static',
        size: 'md',
        resolve: {
          cartItems: function() { return vm.cart.items; },
          totalPrice: function() { return vm.cart.totalPrice; }
        }
      });

      modalInstance.result.then(function (status) {
        $log.debug('Modal OKed at: ' + new Date());
        $window.scrollTo(0, 0);
      }, function () {
        $log.debug('Modal dismissed at: ' + new Date());
      });
    }

    function updateTotalPrice() {
      var itemPrices = _.map(vm.cart.items, function(item) {
        return item.price;
      });
      vm.cart.totalPrice = _.reduce(itemPrices, function(price1, price2) {
        return price1 + price2;
      }, 0);
    }

    function updateIsEmpty() {
      vm.cart.isEmpty = (vm.cart.items.length === 0);
    }

    function initialize() {
      cartSvc.loadCartItems();
      vm.cart = cartSvc.getCart();

      $scope.$watch(function() { return vm.cart.items; }, function() {
        updateTotalPrice();
        updateIsEmpty();
      });
    }
  }
})();

/**
 * Created by Mike on 11/8/2015.
 */

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .factory('cartModel', cartModel);

  cartModel.$inject = [];

  function cartModel() {
    return {
      cart: {
        items: {}
      }
    };
  }
})();

/**
 * Created by Mike on 10/31/2015.
 */

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .factory('cartSvc', cartSvc);

  cartSvc.$inject = ['$log', 'localStorageService', 'cartModel'];

  function cartSvc($log, localStorageService, cartModel) {
    var service = {
      getCart: getCart,
      loadCartItems: loadCartItems,
      saveCartItems: saveCartItems,
      clearCart: clearCart
    };
    return service;

    function getCart() {
      return cartModel.cart;
    }

    function loadCartItems() {
      var result = [];
      // TODO extract constant
      var cartItemsStr = localStorageService.get('amwedding.cartItems');

      // TODO validate the stored data
      if (cartItemsStr !== undefined && cartItemsStr !== null) {
        result = JSON.parse(cartItemsStr);
      }

      updateCartItems(result);
      return result;
    }

    // TODO expose add + remove instead of save?
    function saveCartItems(items) {
      updateCartItems(items);
      localStorageService.set('amwedding.cartItems', JSON.stringify(items));
      $log.debug("Saved items to cart: " + JSON.stringify(items));
    }

    function clearCart() {
      localStorageService.remove('amwedding.cartItems');
      updateCartItems([]);
      $log.debug("Cleared cart!");
    }

    /** Private **/

    function updateCartItems(cartItems) {
      cartModel.cart.items = cartItems;
    }
  }
})();

/**
 * Created by Mike on 11/7/2015.
 */

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .controller('CheckoutModalCtrl', CheckoutModalCtrl);

  CheckoutModalCtrl.$inject = ['$scope', '$log', '$modalInstance', '$http', '$window',
    'cartSvc', 'errorHandlingSvc', 'cartItems', 'totalPrice', 'appConfig'];

// TODO refactor cartItems/totalPrice into one object
  function CheckoutModalCtrl($scope, $log, $modalInstance, $http, $window,
                             cartSvc, errorHandlingSvc, cartItems, totalPrice, appConfig) {

    $scope.submit = submit;
    $scope.cancel = cancel;
    $scope.ok = ok;
    $scope.print = print;

      $scope.checkoutItems = cartItems;
    $scope.checkoutTotal = totalPrice;
    $scope.deliveryMethod = "";
    $scope.isFS = false;
    $scope.isSubmitSuccess = false;
    $scope.isReqSuccess = false;

    function submit(isFormValid) {
      $scope.isFS = true;

      if (isFormValid) {
        $scope.isSubmitSuccess = true;

        var mapCheckoutItemToPurchase = function(checkoutItem) {
          var result = {};
          result.registryItemId = checkoutItem.itemId;
          result.price = checkoutItem.price;
          result.customDescription = checkoutItem.description;
          result.purchasedByNames = $scope.fromNames;
          result.purchasedByEmail = $scope.fromEmail;
          result.deliveryMethod = $scope.deliveryMethod;

          return result;
        };

        var purchaseVmList = _.map($scope.checkoutItems, mapCheckoutItemToPurchase);

        $http.post(appConfig.apiUrl + '/purchases', purchaseVmList).
          success(function(data) {
            $scope.isReqSuccess = true;
            $log.debug("purchase post reply: " + JSON.stringify(data));
            cartSvc.clearCart();
          }).
          error(function(data, status) {
            $modalInstance.dismiss('error');
            errorHandlingSvc.handleHttpError("submitting your registry choices", status);
          });
      }
    }

    function cancel() {
      $modalInstance.dismiss('cancel');
    }

    function ok() {
      $modalInstance.close('ok');
    }

    function print() {
      var giftWindow = $window.open(createLink(), '_blank');
      giftWindow.print();
    }

    function createLink() {
      var itemDescs = _.map($scope.checkoutItems, function(item) { return item.description; });
      var itemDescsStr = JSON.stringify(itemDescs);
      var result = 'wedding-app/components/gift-card/gift.html#/?from=' + encodeURIComponent($scope.fromNames) + '&items=' + encodeURIComponent(itemDescsStr);
      return result;
    }
  }
})();

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .controller('HomeCtrl', HomeCtrl);

  HomeCtrl.$inject = ['$scope', '$window', 'simpleModalsSvc'];

  function HomeCtrl($scope, $window, simpleModalsSvc) {

    $window.scrollTo(0, 0);

    if ($window.screen.width < 1200) {
      simpleModalsSvc.openSimpleModal("Hello!", "We noticed based on your screen size that you are using a mobile device. While the site does support this, you'll still get the optimal experience on a laptop or desktop. Enjoy!", "md");
    }

    $scope.whenSlideShowReady = whenSlideShowReady;

    $scope.imgFilenames = [
      "r1.jpg",
      "g1.jpg",
      "b1.jpg",
      "r2.jpg",
      "g2.jpg",
      "b2.jpg",
      "r3.jpg",
      "g3.jpg",
      "b3.jpg"
      // FIXME Add custom photos for slideshow
    ];

    function whenSlideShowReady() {
      $('#ri-grid').gridrotator( {
        rows: 3,
        columns: 5,

        animSpeed: 700,
        animType: 'random',
        interval: 4000,
        minStep: 3,
        maxStep: 7,

        preventClick: false,

        w1024: {
          rows: 3,
          columns: 5
        },
        w768: {
          rows: 4,
          columns: 3
        },
        w480: {
          rows: 4,
          columns: 3
        },
        w320: {
          rows: 4,
          columns: 3
        },
        w240: {
          rows: 4,
          columns: 3
        }
      });
    }
  }
})();

/**
 * Created by Mike on 4/26/2015.
 */

(function() {
  'use strict';

  var gift = angular.module('giftApp', []);

  gift.config(function($locationProvider) {
    //$locationProvider.html5Mode(true);
  });

  gift.controller('GiftCtrl', function ($scope, $location, $log) {
    $scope.from = $location.search().from;
    $scope.items = JSON.parse($location.search().items);
    $log.debug("from=" + $scope.from + ", items=" + $scope.items);
  });
})();

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .controller('HotelsCtrl', HotelsCtrl);

  HotelsCtrl.$inject = ['$window'];

  function HotelsCtrl($window) {
    $window.scrollTo(0, 0);
  }
})();

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .controller('VenueCtrl', VenueCtrl);

  VenueCtrl.$inject = ['$window'];

  function VenueCtrl($window) {
    $window.scrollTo(0, 0);
  }
})();

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .controller('RegistryCtrl', RegistryCtrl);

  RegistryCtrl.$inject = ['$scope', '$log', '$location', '$window', '$http', 'localStorageService', 'simpleModalsSvc', 'cartSvc', 'appConfig'];

  function RegistryCtrl($scope, $log, $location, $window, $http, localStorageService, simpleModalsSvc, cartSvc, appConfig) {

    $window.scrollTo(0, 0);

    initialize();

    $scope.addToCart = addToCart;

    function addToCart(regItem, form) {
      $scope.isFS = true; // Is form submitted?

      if (form.$valid) {
        var cartItems = cartSvc.loadCartItems();
        $log.debug("Previous cart: " + JSON.stringify(cartItems));

        var newItem = { itemId: regItem.registryItemId, price: parseInt(regItem.selectedPrice), description: regItem.description, imageUrl: regItem.imageUrl };
        cartItems.push(newItem);

        $log.debug("Added new item: " + JSON.stringify(newItem));

        cartSvc.saveCartItems(cartItems);

        $window.location.href = "#/cart";
      } else {
        var errorMsg = "N/A";

        if (form.amount.$error.required) {
          errorMsg = "Please choose an amount for your gift.";
        } else if (form.description.$error.required) {
          errorMsg = "Please enter a description for your gift.";
        }

        simpleModalsSvc.openSimpleModal("Oops!", errorMsg, "sm");
      }
    }

    function initialize() {
      if (!localStorageService.isSupported) {
        simpleModalsSvc.openSimpleModal("Uh oh!", "It appears you are using an outdated browser that doesn't support our registry page. Please upgrade your browser if you would like to use it.", "md");
      }

      $scope.category = $location.search().category;

      if ($scope.category === undefined) {
        $scope.category = "none";
      } else {
        $http.get(appConfig.apiUrl + '/registryItems?category=' + $scope.category).success(function(data) {
          $log.debug("data: " + JSON.stringify(data));

          _.each(data, function(ri) {
            if (_.some(cartSvc.loadCartItems(), function(ci) { return ci.itemId === ri.registryItemId; })) {
              ri.isInCart = true;
            }
            if (ri.prices.length == 1) {
              // Auto-select price if there is only one choice
              ri.selectedPrice = ri.prices[0];
            }
          });
          $scope.registryItems = data;
        });
      }

      $log.debug("Registry category: " + $scope.category);

      setDefaults();
    }

    function setDefaults() {
      $scope.pages = [
        { id: "reg-trans", title: "Transportation", subtitle: "Subtitle", category: "transportation" },
        { id: "reg-accom", title: "Accommodations", subtitle: "Subtitle", category: "accommodations" },
        { id: "reg-dining", title: "Wining & Dining", subtitle: "Subtitle", category: "wining and dining" },
        { id: "reg-explore", title: "Explorations", subtitle: "Subtitle", category: "explorations" },
        { id: "reg-relax", title: "Relaxation", subtitle: "Subtitle", category: "relaxation" }
      ];
    }
  }
})();

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .controller('RsvpCtrl', RsvpCtrl);

  RsvpCtrl.$inject = ['$scope', '$log', '$http', '$window', 'errorHandlingSvc', 'simpleModalsSvc', 'appConfig'];

  function RsvpCtrl($scope, $log, $http, $window, errorHandlingSvc, simpleModalsSvc, appConfig) {

    $window.scrollTo(0, 0);

    setDefaults();

    $scope.storeForms = storeForms;
    $scope.submit = submit;

    function storeForms(form1, form2) {
      if (form1 !== undefined) {
        $scope.selfForm = form1;
      }
      if (form2 !== undefined) {
        $scope.guestForm = form2;
      }
    }

    function submit() {
      $scope.isFS = true; // Is form submitted?

      // Validation
      var isFormValid = $scope.selfForm.$valid && (!$scope.rsvps[1].isActive || $scope.guestForm.$valid);
      var isAllValid = true;

      _.each($scope.rsvps, function(r) {
        if (r.isActive) {
          r.errAttdNotSelected = (!r.attdReception && !r.attdBoat && !r.attdNone);
          r.errAttdBadCombo = (r.attdNone && (r.attdReception || r.attdBoat));
          isAllValid = isFormValid && !r.errAttdNotSelected && !r.errAttdBadCombo;
        }
      });

      if (isAllValid) {
        $scope.isSubmitSuccess = true;

        var activeRsvps = _.filter($scope.rsvps, function(r) {
          return r.isActive;
        });
        _.each(activeRsvps, function(r) {
          // The submitter's information is in the first RSVP form
          r.submitterEmail = activeRsvps[0].email;
        });

        $log.debug(JSON.stringify(activeRsvps));

        $http.post(appConfig.apiUrl + '/rsvps', activeRsvps).
          success(function(data) {
            simpleModalsSvc.openSimpleModal("Success!", "We've received your RSVP. Thanks for responding!", "sm")
              .result.then(function (status) {
                $window.location.href = "#/home";
              });

            $log.debug("rsvp post reply: " + JSON.stringify(data));
          }).
          error(function(data, status) {
            errorHandlingSvc.handleHttpError("submitting your RSVP", status);
          });
      }
    }

    function setDefaults() {
      $scope.isFS = false;
      $scope.isSubmitSuccess = false;

      $scope.dinnerMenu = {
        'Sun-dried Tomato Chicken': 'Sun-dried Tomato, Artichoke & Basil Stuffed Chicken Breast, Golden Whipped Mashed Potatoes, Baby Vegetables, and a Balsamic Reduction',
        'Filet Mignon': 'Sea Salt Rosemary Encrusted Filet Mignon, Truffle Roasted Fingerling Potatoes and Grilled Asparagus',
        'Spinach & Portabella Mushroom': 'Jasmine Rice Topped with a Garlic and Spinach Saute, Grilled Summer Vegetables and Portabella Mushroom and drizzled with Balsamic Glaze and Basil Oil'
      };

      $scope.dinnerChoices = Object.keys($scope.dinnerMenu);

      $log.debug(Object.keys($scope.dinnerMenu));

      // Default values
      var rsvpSelf = {};
      rsvpSelf.guestType = "self";
      rsvpSelf.isActive = true;

      var rsvpGuest = {};
      rsvpGuest.guestType = "guest";
      rsvpGuest.isActive = false;

      $scope.rsvps = [rsvpSelf, rsvpGuest];

      _.each($scope.rsvps, function(r) {
        r.dinner = '';
        r.dessert = '';
        r.attdReception = false;
        r.attdBoat = false;
        r.attdNone = false;
      });
    }
  }
})();

/**
 * Created by Mike on 10/31/2015.
 */

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .factory('errorHandlingSvc', errorHandlingSvc);

  errorHandlingSvc.$inject = ['$log', 'simpleModalsSvc'];

  function errorHandlingSvc($log, simpleModalsSvc) {
    var service = {
      handleHttpError: handleHttpError
    };
    return service;

    function handleHttpError(errorContext, statusCode) {
      $log.debug(format("Http error occurred. context={0}, statusCode={1}", errorContext, statusCode));
      return simpleModalsSvc.openSimpleErrorModal(errorContext);
    }
  }
})();

/**
 * Created by Mike on 11/8/2015.
 */

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .controller('SimpleModalCtrl', SimpleModalCtrl);

  SimpleModalCtrl.$inject = ['$scope', '$modalInstance', 'title', 'message'];

  function SimpleModalCtrl($scope, $modalInstance, title, message) {
    $scope.title = title;
    $scope.message = message;

    $scope.ok = function () {
      $modalInstance.close('ok');
    };
  }
})();

/**
 * Created by Mike on 10/31/2015.
 */

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .factory('simpleModalsSvc', simpleModalsSvc);

  simpleModalsSvc.$inject = ['$modal'];

  function simpleModalsSvc($modal) {
    var service = {
      openSimpleModal: openSimpleModal,
      openSimpleErrorModal: openSimpleErrorModal,
      openUnsentErrorModal: openUnsentErrorModal
    };
    return service;

    function openSimpleModal(title, message, windowSize) {
      return $modal.open({
        templateUrl: 'simple-ok-modal.html',
        controller: 'SimpleModalCtrl',
        backdrop: 'static',
        size: windowSize,
        resolve: {
          title: function() { return title; },
          message: function() { return message; }
        }
      });
    }

    function openSimpleErrorModal(errorContext) {
      return openSimpleModal("Uh oh!", "Sorry, something went wrong on our side " + errorContext + ". We'll be looking into the problem - please try again later.", "md");
    }

    function openUnsentErrorModal(errorContext) {
      return openSimpleModal("Uh oh!", "It looks like something went wrong " + errorContext + " - the information could not be sent. Please check your internet connection or try a different browser.", "md");
    }
  }
})();

/*
 * Source: http://stackoverflow.com/questions/14968690/sending-event-when-angular-js-finished-loading
 * Author: trusktr
 */

/*
 * The whenReady directive allows you to execute the content of a when-ready
 * attribute after the element is ready (i.e. done loading all sub directives and DOM
 * content except for things that load asynchronously like partials and images).
 *
 * Execute multiple expressions by delimiting them with a semi-colon. If there
 * is more than one expression, and the last expression evaluates to true, then
 * all expressions prior will be evaluated after all text nodes in the element
 * have been interpolated (i.e. {{placeholders}} replaced with actual values). 
 *
 * Caveats: if other directives exists on the same element as this directive
 * and destroy the element thus preventing other directives from loading, using
 * this directive won't work. The optimal way to use this is to put this
 * directive on an outer element.
 */

(function() {
  'use strict';

  angular
    .module('weddingApp')
    .directive('whenReady', ['$interpolate', function($interpolate) {
    return {
      restrict: 'A',
      priority: Number.MIN_SAFE_INTEGER, // execute last, after all other directives if any.
      link: function($scope, $element, $attributes) {
        var expressions = $attributes.whenReady.split(';');
        var waitForInterpolation = false;

        function evalExpressions(expressions) {
          expressions.forEach(function(expression) {
            $scope.$eval(expression);
          });
        }

        if ($attributes.whenReady.trim().length == 0) { return; }

        if (expressions.length > 1) {
          if ($scope.$eval(expressions.pop())) {
            waitForInterpolation = true;
          }
        }

        if (waitForInterpolation) {
          requestAnimationFrame(function checkIfInterpolated() {
            if ($element.text().indexOf($interpolate.startSymbol()) >= 0) { // if the text still has {{placeholders}}
              requestAnimationFrame(checkIfInterpolated);
            }
            else {
              evalExpressions(expressions);
            }
          });
        }
        else {
          evalExpressions(expressions);
        }
      }
    };
  }]);
})();
(function() {
  'use strict';

  angular
    .module('weddingApp')
    .controller('NavCtrl', NavCtrl);

  NavCtrl.$inject = ['$scope', 'cartSvc'];

  function NavCtrl($scope, cartSvc) {
    cartSvc.loadCartItems();
    $scope.cart = cartSvc.getCart();

    $scope.$watch(function() { return $scope.cart.items; }, function() {
      updateCartItemCount();
      updateIsCartCounterVisible();
    });

    $scope.tabs = [
      { path: "#/home", label: "Home" },
      { path: "#/venue", label: "Venue" },
      { path: "#/rsvp", label: "RSVP" },
      { path: "#/hotels", label: "Hotels" },
      { path: "#/registry", label: "Registry" },
      { path: "#/cart", label: "" }
    ];

    function updateCartItemCount() {
      $scope.cartItemCount = $scope.cart.items.length;
    }

    function updateIsCartCounterVisible() {
      $scope.isCartCounterVisible = ($scope.cart.items.length > 0);
    }
  }
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC5yb3V0ZXMuanMiLCJjb25maWcvY29uZmlnLmpzIiwiY29tcG9uZW50cy9hZG1pbi9hZG1pbi5qcyIsImNvbXBvbmVudHMvY2FydC9jYXJ0LmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL2NhcnQvY2FydC5tb2RlbC5zZXJ2aWNlLmpzIiwiY29tcG9uZW50cy9jYXJ0L2NhcnQuc2VydmljZS5qcyIsImNvbXBvbmVudHMvY2FydC9jaGVja291dC1tb2RhbC5jb250cm9sbGVyLmpzIiwiY29tcG9uZW50cy9ob21lL2hvbWUuY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvZ2lmdC1jYXJkL2dpZnQuanMiLCJjb21wb25lbnRzL2hvdGVscy9ob3RlbHMuY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvdmVudWUvdmVudWUuY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvcmVnaXN0cnkvcmVnaXN0cnkuY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvcnN2cC9yc3ZwLmNvbnRyb2xsZXIuanMiLCJzaGFyZWQvc2VydmljZXMvZXJyb3ItaGFuZGxpbmcuc2VydmljZS5qcyIsInNoYXJlZC9zZXJ2aWNlcy9zaW1wbGUtbW9kYWwuY29udHJvbGxlci5qcyIsInNoYXJlZC9zZXJ2aWNlcy9zaW1wbGUtbW9kYWxzLnNlcnZpY2UuanMiLCJzaGFyZWQvd2hlbi1yZWFkeS93aGVuLXJlYWR5LmRpcmVjdGl2ZS5qcyIsInNoYXJlZC9uYXZiYXIvbmF2LmNvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAtYnVuZGxlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXIubW9kdWxlKCd3ZWRkaW5nQXBwJywgW1xyXG4gICAgJ25nUm91dGUnLFxyXG4gICAgJ25nQW5pbWF0ZScsXHJcbiAgICAndWkuYm9vdHN0cmFwJyxcclxuICAgICdhcHBDb25maWcnLFxyXG4gICAgJ0xvY2FsU3RvcmFnZU1vZHVsZSdcclxuICBdKS5cclxuICAgIHJ1bihbJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJyRsb2cnLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRsb2cpIHtcclxuICAgICAgLy8gV2F0Y2ggdGhlIFVSTCBsb2NhdGlvbiB0byB1cGRhdGUgdGhlIGFjdGl2ZSB0YWIgb24gdGhlIG5hdmJhclxyXG4gICAgICB2YXIgcGF0aCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gJGxvY2F0aW9uLnBhdGgoKTsgfTtcclxuICAgICAgJHJvb3RTY29wZS4kd2F0Y2gocGF0aCwgZnVuY3Rpb24obmV3VmFsLCBvbGRWYWwpIHtcclxuICAgICAgICAkcm9vdFNjb3BlLmFjdGl2ZVRhYiA9IG5ld1ZhbDtcclxuICAgICAgICAkbG9nLmRlYnVnKFwiQWN0aXZlVGFiOiBcIiArICRyb290U2NvcGUuYWN0aXZlVGFiKTtcclxuICAgICAgfSk7XHJcbiAgICB9XSk7XHJcblxyXG59KSgpO1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBNaWtlIG9uIDExLzgvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyLlxyXG4gICAgbW9kdWxlKCd3ZWRkaW5nQXBwJykuXHJcbiAgICBjb25maWcoWyckcm91dGVQcm92aWRlcicsIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7XHJcbiAgICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgICAgLndoZW4oJy9yc3ZwJywge1xyXG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd2VkZGluZy1hcHAvY29tcG9uZW50cy9yc3ZwL3JzdnAuaHRtbCcsXHJcbiAgICAgICAgICBjb250cm9sbGVyOiAnUnN2cEN0cmwnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAud2hlbignL2hvdGVscycsIHtcclxuICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3dlZGRpbmctYXBwL2NvbXBvbmVudHMvaG90ZWxzL2hvdGVscy5odG1sJyxcclxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb3RlbHNDdHJsJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLndoZW4oJy9yZWdpc3RyeScsIHtcclxuICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3dlZGRpbmctYXBwL2NvbXBvbmVudHMvcmVnaXN0cnkvcmVnaXN0cnkuaHRtbCcsXHJcbiAgICAgICAgICBjb250cm9sbGVyOiAnUmVnaXN0cnlDdHJsJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLndoZW4oJy9ob21lJywge1xyXG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd2VkZGluZy1hcHAvY29tcG9uZW50cy9ob21lL2hvbWUuaHRtbCcsXHJcbiAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUN0cmwnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAud2hlbignL3ZlbnVlJywge1xyXG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICcvd2VkZGluZy1hcHAvY29tcG9uZW50cy92ZW51ZS92ZW51ZS5odG1sJyxcclxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdWZW51ZUN0cmwnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAud2hlbignL2NhcnQnLCB7XHJcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJy93ZWRkaW5nLWFwcC9jb21wb25lbnRzL2NhcnQvY2FydC5odG1sJyxcclxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdDYXJ0Q3RybCcsXHJcbiAgICAgICAgICAvLyBUT0RPIFN3aXRjaCB0aGUgcmVzdCBvZiB0aGUgY29udHJvbGxlcnMgdG8gdXNlIHRoaXMgXCJjb250cm9sbGVyQXMgdm1cIiBzeW50YXhcclxuICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAkcm91dGVQcm92aWRlci5vdGhlcndpc2Uoe3JlZGlyZWN0VG86ICcvaG9tZSd9KTtcclxuICAgIH1dKTtcclxufSkoKTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWlrZSBvbiA1LzQvMjAxNS5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyLm1vZHVsZSgnYXBwQ29uZmlnJyxbXSlcclxuICAgIC5jb25zdGFudCgnYXBwQ29uZmlnJyxcclxuICAgIHtcclxuICAgICAgJ2FwaVVybCc6ICdodHRwOi8vbG9jYWxob3N0OjgwODAvd2VkZGluZy13cy92MScsXHJcbiAgICAgICd3ZWJSb290UGF0aCc6ICcvc3JjL3dlZGRpbmctd2Vic2l0ZS9hcHAvJ1xyXG4gICAgfSk7XHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1pa2Ugb24gNS8yNS8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXIubW9kdWxlKCdhZG1pbkFwcCcsIFsnYXBwQ29uZmlnJ10pO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhZG1pbkFwcCcpXHJcbiAgICAuY29udHJvbGxlcignQWRtaW5DdHJsJywgQWRtaW5DdHJsKTtcclxuXHJcbiAgQWRtaW5DdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckbG9nJywgJyRodHRwJywgJ2FwcENvbmZpZyddO1xyXG5cclxuICBmdW5jdGlvbiBBZG1pbkN0cmwoJHNjb3BlLCAkbG9nLCAkaHR0cCwgYXBwQ29uZmlnKSB7XHJcbiAgICAkaHR0cC5nZXQoYXBwQ29uZmlnLmFwaVVybCArICcvcnN2cHMnKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgJGxvZy5kZWJ1ZyhcImRhdGE6IFwiICsgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG5cclxuICAgICAgJHNjb3BlLnJzdnBzID0gZGF0YTtcclxuICAgIH0pO1xyXG4gIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnd2VkZGluZ0FwcCcpXHJcbiAgICAuY29udHJvbGxlcignQ2FydEN0cmwnLCBDYXJ0Q3RybCk7XHJcblxyXG4gIENhcnRDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckbG9nJywgJyR3aW5kb3cnLCAnJG1vZGFsJywgJ2NhcnRTdmMnXTtcclxuXHJcbiAgZnVuY3Rpb24gQ2FydEN0cmwoJHNjb3BlLCAkbG9nLCAkd2luZG93LCAkbW9kYWwsIGNhcnRTdmMpIHtcclxuICAgICR3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7XHJcblxyXG4gICAgdmFyIHZtID0gdGhpcztcclxuICAgIGluaXRpYWxpemUoKTtcclxuXHJcbiAgICB2bS5yZW1vdmVDYXJ0SXRlbSA9IHJlbW92ZUNhcnRJdGVtO1xyXG4gICAgdm0uY2hlY2tvdXQgPSBjaGVja291dDtcclxuXHJcbiAgICBmdW5jdGlvbiByZW1vdmVDYXJ0SXRlbShpdGVtSWQpIHtcclxuICAgICAgdmFyIG5ld0NhcnRJdGVtcyA9IF8uZmlsdGVyKHZtLmNhcnQuaXRlbXMsIGZ1bmN0aW9uKGlkKSB7IHJldHVybiBpZC5pdGVtSWQgIT09IGl0ZW1JZDsgfSk7XHJcbiAgICAgIGNhcnRTdmMuc2F2ZUNhcnRJdGVtcyhuZXdDYXJ0SXRlbXMpO1xyXG4gICAgICAkbG9nLmRlYnVnKFwiUmVtb3ZlZCBpdGVtIHdpdGggaWQ9XCIgKyBpdGVtSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNoZWNrb3V0KCkge1xyXG4gICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICRtb2RhbC5vcGVuKHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2NoZWNrb3V0Lmh0bWwnLFxyXG4gICAgICAgIGNvbnRyb2xsZXI6ICdDaGVja291dE1vZGFsQ3RybCcsXHJcbiAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgIHNpemU6ICdtZCcsXHJcbiAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgY2FydEl0ZW1zOiBmdW5jdGlvbigpIHsgcmV0dXJuIHZtLmNhcnQuaXRlbXM7IH0sXHJcbiAgICAgICAgICB0b3RhbFByaWNlOiBmdW5jdGlvbigpIHsgcmV0dXJuIHZtLmNhcnQudG90YWxQcmljZTsgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChzdGF0dXMpIHtcclxuICAgICAgICAkbG9nLmRlYnVnKCdNb2RhbCBPS2VkIGF0OiAnICsgbmV3IERhdGUoKSk7XHJcbiAgICAgICAgJHdpbmRvdy5zY3JvbGxUbygwLCAwKTtcclxuICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRsb2cuZGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB1cGRhdGVUb3RhbFByaWNlKCkge1xyXG4gICAgICB2YXIgaXRlbVByaWNlcyA9IF8ubWFwKHZtLmNhcnQuaXRlbXMsIGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICByZXR1cm4gaXRlbS5wcmljZTtcclxuICAgICAgfSk7XHJcbiAgICAgIHZtLmNhcnQudG90YWxQcmljZSA9IF8ucmVkdWNlKGl0ZW1QcmljZXMsIGZ1bmN0aW9uKHByaWNlMSwgcHJpY2UyKSB7XHJcbiAgICAgICAgcmV0dXJuIHByaWNlMSArIHByaWNlMjtcclxuICAgICAgfSwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdXBkYXRlSXNFbXB0eSgpIHtcclxuICAgICAgdm0uY2FydC5pc0VtcHR5ID0gKHZtLmNhcnQuaXRlbXMubGVuZ3RoID09PSAwKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xyXG4gICAgICBjYXJ0U3ZjLmxvYWRDYXJ0SXRlbXMoKTtcclxuICAgICAgdm0uY2FydCA9IGNhcnRTdmMuZ2V0Q2FydCgpO1xyXG5cclxuICAgICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpIHsgcmV0dXJuIHZtLmNhcnQuaXRlbXM7IH0sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHVwZGF0ZVRvdGFsUHJpY2UoKTtcclxuICAgICAgICB1cGRhdGVJc0VtcHR5KCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufSkoKTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWlrZSBvbiAxMS84LzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnd2VkZGluZ0FwcCcpXHJcbiAgICAuZmFjdG9yeSgnY2FydE1vZGVsJywgY2FydE1vZGVsKTtcclxuXHJcbiAgY2FydE1vZGVsLiRpbmplY3QgPSBbXTtcclxuXHJcbiAgZnVuY3Rpb24gY2FydE1vZGVsKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY2FydDoge1xyXG4gICAgICAgIGl0ZW1zOiB7fVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxufSkoKTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWlrZSBvbiAxMC8zMS8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ3dlZGRpbmdBcHAnKVxyXG4gICAgLmZhY3RvcnkoJ2NhcnRTdmMnLCBjYXJ0U3ZjKTtcclxuXHJcbiAgY2FydFN2Yy4kaW5qZWN0ID0gWyckbG9nJywgJ2xvY2FsU3RvcmFnZVNlcnZpY2UnLCAnY2FydE1vZGVsJ107XHJcblxyXG4gIGZ1bmN0aW9uIGNhcnRTdmMoJGxvZywgbG9jYWxTdG9yYWdlU2VydmljZSwgY2FydE1vZGVsKSB7XHJcbiAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgZ2V0Q2FydDogZ2V0Q2FydCxcclxuICAgICAgbG9hZENhcnRJdGVtczogbG9hZENhcnRJdGVtcyxcclxuICAgICAgc2F2ZUNhcnRJdGVtczogc2F2ZUNhcnRJdGVtcyxcclxuICAgICAgY2xlYXJDYXJ0OiBjbGVhckNhcnRcclxuICAgIH07XHJcbiAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRDYXJ0KCkge1xyXG4gICAgICByZXR1cm4gY2FydE1vZGVsLmNhcnQ7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbG9hZENhcnRJdGVtcygpIHtcclxuICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAvLyBUT0RPIGV4dHJhY3QgY29uc3RhbnRcclxuICAgICAgdmFyIGNhcnRJdGVtc1N0ciA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhbXdlZGRpbmcuY2FydEl0ZW1zJyk7XHJcblxyXG4gICAgICAvLyBUT0RPIHZhbGlkYXRlIHRoZSBzdG9yZWQgZGF0YVxyXG4gICAgICBpZiAoY2FydEl0ZW1zU3RyICE9PSB1bmRlZmluZWQgJiYgY2FydEl0ZW1zU3RyICE9PSBudWxsKSB7XHJcbiAgICAgICAgcmVzdWx0ID0gSlNPTi5wYXJzZShjYXJ0SXRlbXNTdHIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB1cGRhdGVDYXJ0SXRlbXMocmVzdWx0KTtcclxuICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUT0RPIGV4cG9zZSBhZGQgKyByZW1vdmUgaW5zdGVhZCBvZiBzYXZlP1xyXG4gICAgZnVuY3Rpb24gc2F2ZUNhcnRJdGVtcyhpdGVtcykge1xyXG4gICAgICB1cGRhdGVDYXJ0SXRlbXMoaXRlbXMpO1xyXG4gICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYW13ZWRkaW5nLmNhcnRJdGVtcycsIEpTT04uc3RyaW5naWZ5KGl0ZW1zKSk7XHJcbiAgICAgICRsb2cuZGVidWcoXCJTYXZlZCBpdGVtcyB0byBjYXJ0OiBcIiArIEpTT04uc3RyaW5naWZ5KGl0ZW1zKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY2xlYXJDYXJ0KCkge1xyXG4gICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnJlbW92ZSgnYW13ZWRkaW5nLmNhcnRJdGVtcycpO1xyXG4gICAgICB1cGRhdGVDYXJ0SXRlbXMoW10pO1xyXG4gICAgICAkbG9nLmRlYnVnKFwiQ2xlYXJlZCBjYXJ0IVwiKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiogUHJpdmF0ZSAqKi9cclxuXHJcbiAgICBmdW5jdGlvbiB1cGRhdGVDYXJ0SXRlbXMoY2FydEl0ZW1zKSB7XHJcbiAgICAgIGNhcnRNb2RlbC5jYXJ0Lml0ZW1zID0gY2FydEl0ZW1zO1xyXG4gICAgfVxyXG4gIH1cclxufSkoKTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWlrZSBvbiAxMS83LzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnd2VkZGluZ0FwcCcpXHJcbiAgICAuY29udHJvbGxlcignQ2hlY2tvdXRNb2RhbEN0cmwnLCBDaGVja291dE1vZGFsQ3RybCk7XHJcblxyXG4gIENoZWNrb3V0TW9kYWxDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckbG9nJywgJyRtb2RhbEluc3RhbmNlJywgJyRodHRwJywgJyR3aW5kb3cnLFxyXG4gICAgJ2NhcnRTdmMnLCAnZXJyb3JIYW5kbGluZ1N2YycsICdjYXJ0SXRlbXMnLCAndG90YWxQcmljZScsICdhcHBDb25maWcnXTtcclxuXHJcbi8vIFRPRE8gcmVmYWN0b3IgY2FydEl0ZW1zL3RvdGFsUHJpY2UgaW50byBvbmUgb2JqZWN0XHJcbiAgZnVuY3Rpb24gQ2hlY2tvdXRNb2RhbEN0cmwoJHNjb3BlLCAkbG9nLCAkbW9kYWxJbnN0YW5jZSwgJGh0dHAsICR3aW5kb3csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FydFN2YywgZXJyb3JIYW5kbGluZ1N2YywgY2FydEl0ZW1zLCB0b3RhbFByaWNlLCBhcHBDb25maWcpIHtcclxuXHJcbiAgICAkc2NvcGUuc3VibWl0ID0gc3VibWl0O1xyXG4gICAgJHNjb3BlLmNhbmNlbCA9IGNhbmNlbDtcclxuICAgICRzY29wZS5vayA9IG9rO1xyXG4gICAgJHNjb3BlLnByaW50ID0gcHJpbnQ7XHJcblxyXG4gICAgICAkc2NvcGUuY2hlY2tvdXRJdGVtcyA9IGNhcnRJdGVtcztcclxuICAgICRzY29wZS5jaGVja291dFRvdGFsID0gdG90YWxQcmljZTtcclxuICAgICRzY29wZS5kZWxpdmVyeU1ldGhvZCA9IFwiXCI7XHJcbiAgICAkc2NvcGUuaXNGUyA9IGZhbHNlO1xyXG4gICAgJHNjb3BlLmlzU3VibWl0U3VjY2VzcyA9IGZhbHNlO1xyXG4gICAgJHNjb3BlLmlzUmVxU3VjY2VzcyA9IGZhbHNlO1xyXG5cclxuICAgIGZ1bmN0aW9uIHN1Ym1pdChpc0Zvcm1WYWxpZCkge1xyXG4gICAgICAkc2NvcGUuaXNGUyA9IHRydWU7XHJcblxyXG4gICAgICBpZiAoaXNGb3JtVmFsaWQpIHtcclxuICAgICAgICAkc2NvcGUuaXNTdWJtaXRTdWNjZXNzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgdmFyIG1hcENoZWNrb3V0SXRlbVRvUHVyY2hhc2UgPSBmdW5jdGlvbihjaGVja291dEl0ZW0pIHtcclxuICAgICAgICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgICAgICAgIHJlc3VsdC5yZWdpc3RyeUl0ZW1JZCA9IGNoZWNrb3V0SXRlbS5pdGVtSWQ7XHJcbiAgICAgICAgICByZXN1bHQucHJpY2UgPSBjaGVja291dEl0ZW0ucHJpY2U7XHJcbiAgICAgICAgICByZXN1bHQuY3VzdG9tRGVzY3JpcHRpb24gPSBjaGVja291dEl0ZW0uZGVzY3JpcHRpb247XHJcbiAgICAgICAgICByZXN1bHQucHVyY2hhc2VkQnlOYW1lcyA9ICRzY29wZS5mcm9tTmFtZXM7XHJcbiAgICAgICAgICByZXN1bHQucHVyY2hhc2VkQnlFbWFpbCA9ICRzY29wZS5mcm9tRW1haWw7XHJcbiAgICAgICAgICByZXN1bHQuZGVsaXZlcnlNZXRob2QgPSAkc2NvcGUuZGVsaXZlcnlNZXRob2Q7XHJcblxyXG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgcHVyY2hhc2VWbUxpc3QgPSBfLm1hcCgkc2NvcGUuY2hlY2tvdXRJdGVtcywgbWFwQ2hlY2tvdXRJdGVtVG9QdXJjaGFzZSk7XHJcblxyXG4gICAgICAgICRodHRwLnBvc3QoYXBwQ29uZmlnLmFwaVVybCArICcvcHVyY2hhc2VzJywgcHVyY2hhc2VWbUxpc3QpLlxyXG4gICAgICAgICAgc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5pc1JlcVN1Y2Nlc3MgPSB0cnVlO1xyXG4gICAgICAgICAgICAkbG9nLmRlYnVnKFwicHVyY2hhc2UgcG9zdCByZXBseTogXCIgKyBKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICAgICAgICAgIGNhcnRTdmMuY2xlYXJDYXJ0KCk7XHJcbiAgICAgICAgICB9KS5cclxuICAgICAgICAgIGVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdlcnJvcicpO1xyXG4gICAgICAgICAgICBlcnJvckhhbmRsaW5nU3ZjLmhhbmRsZUh0dHBFcnJvcihcInN1Ym1pdHRpbmcgeW91ciByZWdpc3RyeSBjaG9pY2VzXCIsIHN0YXR1cyk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcclxuICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gb2soKSB7XHJcbiAgICAgICRtb2RhbEluc3RhbmNlLmNsb3NlKCdvaycpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHByaW50KCkge1xyXG4gICAgICB2YXIgZ2lmdFdpbmRvdyA9ICR3aW5kb3cub3BlbihjcmVhdGVMaW5rKCksICdfYmxhbmsnKTtcclxuICAgICAgZ2lmdFdpbmRvdy5wcmludCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZUxpbmsoKSB7XHJcbiAgICAgIHZhciBpdGVtRGVzY3MgPSBfLm1hcCgkc2NvcGUuY2hlY2tvdXRJdGVtcywgZnVuY3Rpb24oaXRlbSkgeyByZXR1cm4gaXRlbS5kZXNjcmlwdGlvbjsgfSk7XHJcbiAgICAgIHZhciBpdGVtRGVzY3NTdHIgPSBKU09OLnN0cmluZ2lmeShpdGVtRGVzY3MpO1xyXG4gICAgICB2YXIgcmVzdWx0ID0gJ3dlZGRpbmctYXBwL2NvbXBvbmVudHMvZ2lmdC1jYXJkL2dpZnQuaHRtbCMvP2Zyb209JyArIGVuY29kZVVSSUNvbXBvbmVudCgkc2NvcGUuZnJvbU5hbWVzKSArICcmaXRlbXM9JyArIGVuY29kZVVSSUNvbXBvbmVudChpdGVtRGVzY3NTdHIpO1xyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnd2VkZGluZ0FwcCcpXHJcbiAgICAuY29udHJvbGxlcignSG9tZUN0cmwnLCBIb21lQ3RybCk7XHJcblxyXG4gIEhvbWVDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckd2luZG93JywgJ3NpbXBsZU1vZGFsc1N2YyddO1xyXG5cclxuICBmdW5jdGlvbiBIb21lQ3RybCgkc2NvcGUsICR3aW5kb3csIHNpbXBsZU1vZGFsc1N2Yykge1xyXG5cclxuICAgICR3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7XHJcblxyXG4gICAgaWYgKCR3aW5kb3cuc2NyZWVuLndpZHRoIDwgMTIwMCkge1xyXG4gICAgICBzaW1wbGVNb2RhbHNTdmMub3BlblNpbXBsZU1vZGFsKFwiSGVsbG8hXCIsIFwiV2Ugbm90aWNlZCBiYXNlZCBvbiB5b3VyIHNjcmVlbiBzaXplIHRoYXQgeW91IGFyZSB1c2luZyBhIG1vYmlsZSBkZXZpY2UuIFdoaWxlIHRoZSBzaXRlIGRvZXMgc3VwcG9ydCB0aGlzLCB5b3UnbGwgc3RpbGwgZ2V0IHRoZSBvcHRpbWFsIGV4cGVyaWVuY2Ugb24gYSBsYXB0b3Agb3IgZGVza3RvcC4gRW5qb3khXCIsIFwibWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLndoZW5TbGlkZVNob3dSZWFkeSA9IHdoZW5TbGlkZVNob3dSZWFkeTtcclxuXHJcbiAgICAkc2NvcGUuaW1nRmlsZW5hbWVzID0gW1xyXG4gICAgICBcInIxLmpwZ1wiLFxyXG4gICAgICBcImcxLmpwZ1wiLFxyXG4gICAgICBcImIxLmpwZ1wiLFxyXG4gICAgICBcInIyLmpwZ1wiLFxyXG4gICAgICBcImcyLmpwZ1wiLFxyXG4gICAgICBcImIyLmpwZ1wiLFxyXG4gICAgICBcInIzLmpwZ1wiLFxyXG4gICAgICBcImczLmpwZ1wiLFxyXG4gICAgICBcImIzLmpwZ1wiXHJcbiAgICAgIC8vIEZJWE1FIEFkZCBjdXN0b20gcGhvdG9zIGZvciBzbGlkZXNob3dcclxuICAgIF07XHJcblxyXG4gICAgZnVuY3Rpb24gd2hlblNsaWRlU2hvd1JlYWR5KCkge1xyXG4gICAgICAkKCcjcmktZ3JpZCcpLmdyaWRyb3RhdG9yKCB7XHJcbiAgICAgICAgcm93czogMyxcclxuICAgICAgICBjb2x1bW5zOiA1LFxyXG5cclxuICAgICAgICBhbmltU3BlZWQ6IDcwMCxcclxuICAgICAgICBhbmltVHlwZTogJ3JhbmRvbScsXHJcbiAgICAgICAgaW50ZXJ2YWw6IDQwMDAsXHJcbiAgICAgICAgbWluU3RlcDogMyxcclxuICAgICAgICBtYXhTdGVwOiA3LFxyXG5cclxuICAgICAgICBwcmV2ZW50Q2xpY2s6IGZhbHNlLFxyXG5cclxuICAgICAgICB3MTAyNDoge1xyXG4gICAgICAgICAgcm93czogMyxcclxuICAgICAgICAgIGNvbHVtbnM6IDVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHc3Njg6IHtcclxuICAgICAgICAgIHJvd3M6IDQsXHJcbiAgICAgICAgICBjb2x1bW5zOiAzXHJcbiAgICAgICAgfSxcclxuICAgICAgICB3NDgwOiB7XHJcbiAgICAgICAgICByb3dzOiA0LFxyXG4gICAgICAgICAgY29sdW1uczogM1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdzMyMDoge1xyXG4gICAgICAgICAgcm93czogNCxcclxuICAgICAgICAgIGNvbHVtbnM6IDNcclxuICAgICAgICB9LFxyXG4gICAgICAgIHcyNDA6IHtcclxuICAgICAgICAgIHJvd3M6IDQsXHJcbiAgICAgICAgICBjb2x1bW5zOiAzXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IE1pa2Ugb24gNC8yNi8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIHZhciBnaWZ0ID0gYW5ndWxhci5tb2R1bGUoJ2dpZnRBcHAnLCBbXSk7XHJcblxyXG4gIGdpZnQuY29uZmlnKGZ1bmN0aW9uKCRsb2NhdGlvblByb3ZpZGVyKSB7XHJcbiAgICAvLyRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuICB9KTtcclxuXHJcbiAgZ2lmdC5jb250cm9sbGVyKCdHaWZ0Q3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgJGxvZykge1xyXG4gICAgJHNjb3BlLmZyb20gPSAkbG9jYXRpb24uc2VhcmNoKCkuZnJvbTtcclxuICAgICRzY29wZS5pdGVtcyA9IEpTT04ucGFyc2UoJGxvY2F0aW9uLnNlYXJjaCgpLml0ZW1zKTtcclxuICAgICRsb2cuZGVidWcoXCJmcm9tPVwiICsgJHNjb3BlLmZyb20gKyBcIiwgaXRlbXM9XCIgKyAkc2NvcGUuaXRlbXMpO1xyXG4gIH0pO1xyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCd3ZWRkaW5nQXBwJylcclxuICAgIC5jb250cm9sbGVyKCdIb3RlbHNDdHJsJywgSG90ZWxzQ3RybCk7XHJcblxyXG4gIEhvdGVsc0N0cmwuJGluamVjdCA9IFsnJHdpbmRvdyddO1xyXG5cclxuICBmdW5jdGlvbiBIb3RlbHNDdHJsKCR3aW5kb3cpIHtcclxuICAgICR3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7XHJcbiAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCd3ZWRkaW5nQXBwJylcclxuICAgIC5jb250cm9sbGVyKCdWZW51ZUN0cmwnLCBWZW51ZUN0cmwpO1xyXG5cclxuICBWZW51ZUN0cmwuJGluamVjdCA9IFsnJHdpbmRvdyddO1xyXG5cclxuICBmdW5jdGlvbiBWZW51ZUN0cmwoJHdpbmRvdykge1xyXG4gICAgJHdpbmRvdy5zY3JvbGxUbygwLCAwKTtcclxuICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ3dlZGRpbmdBcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1JlZ2lzdHJ5Q3RybCcsIFJlZ2lzdHJ5Q3RybCk7XHJcblxyXG4gIFJlZ2lzdHJ5Q3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJGxvZycsICckbG9jYXRpb24nLCAnJHdpbmRvdycsICckaHR0cCcsICdsb2NhbFN0b3JhZ2VTZXJ2aWNlJywgJ3NpbXBsZU1vZGFsc1N2YycsICdjYXJ0U3ZjJywgJ2FwcENvbmZpZyddO1xyXG5cclxuICBmdW5jdGlvbiBSZWdpc3RyeUN0cmwoJHNjb3BlLCAkbG9nLCAkbG9jYXRpb24sICR3aW5kb3csICRodHRwLCBsb2NhbFN0b3JhZ2VTZXJ2aWNlLCBzaW1wbGVNb2RhbHNTdmMsIGNhcnRTdmMsIGFwcENvbmZpZykge1xyXG5cclxuICAgICR3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7XHJcblxyXG4gICAgaW5pdGlhbGl6ZSgpO1xyXG5cclxuICAgICRzY29wZS5hZGRUb0NhcnQgPSBhZGRUb0NhcnQ7XHJcblxyXG4gICAgZnVuY3Rpb24gYWRkVG9DYXJ0KHJlZ0l0ZW0sIGZvcm0pIHtcclxuICAgICAgJHNjb3BlLmlzRlMgPSB0cnVlOyAvLyBJcyBmb3JtIHN1Ym1pdHRlZD9cclxuXHJcbiAgICAgIGlmIChmb3JtLiR2YWxpZCkge1xyXG4gICAgICAgIHZhciBjYXJ0SXRlbXMgPSBjYXJ0U3ZjLmxvYWRDYXJ0SXRlbXMoKTtcclxuICAgICAgICAkbG9nLmRlYnVnKFwiUHJldmlvdXMgY2FydDogXCIgKyBKU09OLnN0cmluZ2lmeShjYXJ0SXRlbXMpKTtcclxuXHJcbiAgICAgICAgdmFyIG5ld0l0ZW0gPSB7IGl0ZW1JZDogcmVnSXRlbS5yZWdpc3RyeUl0ZW1JZCwgcHJpY2U6IHBhcnNlSW50KHJlZ0l0ZW0uc2VsZWN0ZWRQcmljZSksIGRlc2NyaXB0aW9uOiByZWdJdGVtLmRlc2NyaXB0aW9uLCBpbWFnZVVybDogcmVnSXRlbS5pbWFnZVVybCB9O1xyXG4gICAgICAgIGNhcnRJdGVtcy5wdXNoKG5ld0l0ZW0pO1xyXG5cclxuICAgICAgICAkbG9nLmRlYnVnKFwiQWRkZWQgbmV3IGl0ZW06IFwiICsgSlNPTi5zdHJpbmdpZnkobmV3SXRlbSkpO1xyXG5cclxuICAgICAgICBjYXJ0U3ZjLnNhdmVDYXJ0SXRlbXMoY2FydEl0ZW1zKTtcclxuXHJcbiAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIjL2NhcnRcIjtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB2YXIgZXJyb3JNc2cgPSBcIk4vQVwiO1xyXG5cclxuICAgICAgICBpZiAoZm9ybS5hbW91bnQuJGVycm9yLnJlcXVpcmVkKSB7XHJcbiAgICAgICAgICBlcnJvck1zZyA9IFwiUGxlYXNlIGNob29zZSBhbiBhbW91bnQgZm9yIHlvdXIgZ2lmdC5cIjtcclxuICAgICAgICB9IGVsc2UgaWYgKGZvcm0uZGVzY3JpcHRpb24uJGVycm9yLnJlcXVpcmVkKSB7XHJcbiAgICAgICAgICBlcnJvck1zZyA9IFwiUGxlYXNlIGVudGVyIGEgZGVzY3JpcHRpb24gZm9yIHlvdXIgZ2lmdC5cIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNpbXBsZU1vZGFsc1N2Yy5vcGVuU2ltcGxlTW9kYWwoXCJPb3BzIVwiLCBlcnJvck1zZywgXCJzbVwiKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XHJcbiAgICAgIGlmICghbG9jYWxTdG9yYWdlU2VydmljZS5pc1N1cHBvcnRlZCkge1xyXG4gICAgICAgIHNpbXBsZU1vZGFsc1N2Yy5vcGVuU2ltcGxlTW9kYWwoXCJVaCBvaCFcIiwgXCJJdCBhcHBlYXJzIHlvdSBhcmUgdXNpbmcgYW4gb3V0ZGF0ZWQgYnJvd3NlciB0aGF0IGRvZXNuJ3Qgc3VwcG9ydCBvdXIgcmVnaXN0cnkgcGFnZS4gUGxlYXNlIHVwZ3JhZGUgeW91ciBicm93c2VyIGlmIHlvdSB3b3VsZCBsaWtlIHRvIHVzZSBpdC5cIiwgXCJtZFwiKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgJHNjb3BlLmNhdGVnb3J5ID0gJGxvY2F0aW9uLnNlYXJjaCgpLmNhdGVnb3J5O1xyXG5cclxuICAgICAgaWYgKCRzY29wZS5jYXRlZ29yeSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgJHNjb3BlLmNhdGVnb3J5ID0gXCJub25lXCI7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGh0dHAuZ2V0KGFwcENvbmZpZy5hcGlVcmwgKyAnL3JlZ2lzdHJ5SXRlbXM/Y2F0ZWdvcnk9JyArICRzY29wZS5jYXRlZ29yeSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAkbG9nLmRlYnVnKFwiZGF0YTogXCIgKyBKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcblxyXG4gICAgICAgICAgXy5lYWNoKGRhdGEsIGZ1bmN0aW9uKHJpKSB7XHJcbiAgICAgICAgICAgIGlmIChfLnNvbWUoY2FydFN2Yy5sb2FkQ2FydEl0ZW1zKCksIGZ1bmN0aW9uKGNpKSB7IHJldHVybiBjaS5pdGVtSWQgPT09IHJpLnJlZ2lzdHJ5SXRlbUlkOyB9KSkge1xyXG4gICAgICAgICAgICAgIHJpLmlzSW5DYXJ0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmkucHJpY2VzLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgLy8gQXV0by1zZWxlY3QgcHJpY2UgaWYgdGhlcmUgaXMgb25seSBvbmUgY2hvaWNlXHJcbiAgICAgICAgICAgICAgcmkuc2VsZWN0ZWRQcmljZSA9IHJpLnByaWNlc1swXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICAkc2NvcGUucmVnaXN0cnlJdGVtcyA9IGRhdGE7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgICRsb2cuZGVidWcoXCJSZWdpc3RyeSBjYXRlZ29yeTogXCIgKyAkc2NvcGUuY2F0ZWdvcnkpO1xyXG5cclxuICAgICAgc2V0RGVmYXVsdHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzZXREZWZhdWx0cygpIHtcclxuICAgICAgJHNjb3BlLnBhZ2VzID0gW1xyXG4gICAgICAgIHsgaWQ6IFwicmVnLXRyYW5zXCIsIHRpdGxlOiBcIlRyYW5zcG9ydGF0aW9uXCIsIHN1YnRpdGxlOiBcIlN1YnRpdGxlXCIsIGNhdGVnb3J5OiBcInRyYW5zcG9ydGF0aW9uXCIgfSxcclxuICAgICAgICB7IGlkOiBcInJlZy1hY2NvbVwiLCB0aXRsZTogXCJBY2NvbW1vZGF0aW9uc1wiLCBzdWJ0aXRsZTogXCJTdWJ0aXRsZVwiLCBjYXRlZ29yeTogXCJhY2NvbW1vZGF0aW9uc1wiIH0sXHJcbiAgICAgICAgeyBpZDogXCJyZWctZGluaW5nXCIsIHRpdGxlOiBcIldpbmluZyAmIERpbmluZ1wiLCBzdWJ0aXRsZTogXCJTdWJ0aXRsZVwiLCBjYXRlZ29yeTogXCJ3aW5pbmcgYW5kIGRpbmluZ1wiIH0sXHJcbiAgICAgICAgeyBpZDogXCJyZWctZXhwbG9yZVwiLCB0aXRsZTogXCJFeHBsb3JhdGlvbnNcIiwgc3VidGl0bGU6IFwiU3VidGl0bGVcIiwgY2F0ZWdvcnk6IFwiZXhwbG9yYXRpb25zXCIgfSxcclxuICAgICAgICB7IGlkOiBcInJlZy1yZWxheFwiLCB0aXRsZTogXCJSZWxheGF0aW9uXCIsIHN1YnRpdGxlOiBcIlN1YnRpdGxlXCIsIGNhdGVnb3J5OiBcInJlbGF4YXRpb25cIiB9XHJcbiAgICAgIF07XHJcbiAgICB9XHJcbiAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCd3ZWRkaW5nQXBwJylcclxuICAgIC5jb250cm9sbGVyKCdSc3ZwQ3RybCcsIFJzdnBDdHJsKTtcclxuXHJcbiAgUnN2cEN0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJyRsb2cnLCAnJGh0dHAnLCAnJHdpbmRvdycsICdlcnJvckhhbmRsaW5nU3ZjJywgJ3NpbXBsZU1vZGFsc1N2YycsICdhcHBDb25maWcnXTtcclxuXHJcbiAgZnVuY3Rpb24gUnN2cEN0cmwoJHNjb3BlLCAkbG9nLCAkaHR0cCwgJHdpbmRvdywgZXJyb3JIYW5kbGluZ1N2Yywgc2ltcGxlTW9kYWxzU3ZjLCBhcHBDb25maWcpIHtcclxuXHJcbiAgICAkd2luZG93LnNjcm9sbFRvKDAsIDApO1xyXG5cclxuICAgIHNldERlZmF1bHRzKCk7XHJcblxyXG4gICAgJHNjb3BlLnN0b3JlRm9ybXMgPSBzdG9yZUZvcm1zO1xyXG4gICAgJHNjb3BlLnN1Ym1pdCA9IHN1Ym1pdDtcclxuXHJcbiAgICBmdW5jdGlvbiBzdG9yZUZvcm1zKGZvcm0xLCBmb3JtMikge1xyXG4gICAgICBpZiAoZm9ybTEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICRzY29wZS5zZWxmRm9ybSA9IGZvcm0xO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChmb3JtMiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgJHNjb3BlLmd1ZXN0Rm9ybSA9IGZvcm0yO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc3VibWl0KCkge1xyXG4gICAgICAkc2NvcGUuaXNGUyA9IHRydWU7IC8vIElzIGZvcm0gc3VibWl0dGVkP1xyXG5cclxuICAgICAgLy8gVmFsaWRhdGlvblxyXG4gICAgICB2YXIgaXNGb3JtVmFsaWQgPSAkc2NvcGUuc2VsZkZvcm0uJHZhbGlkICYmICghJHNjb3BlLnJzdnBzWzFdLmlzQWN0aXZlIHx8ICRzY29wZS5ndWVzdEZvcm0uJHZhbGlkKTtcclxuICAgICAgdmFyIGlzQWxsVmFsaWQgPSB0cnVlO1xyXG5cclxuICAgICAgXy5lYWNoKCRzY29wZS5yc3ZwcywgZnVuY3Rpb24ocikge1xyXG4gICAgICAgIGlmIChyLmlzQWN0aXZlKSB7XHJcbiAgICAgICAgICByLmVyckF0dGROb3RTZWxlY3RlZCA9ICghci5hdHRkUmVjZXB0aW9uICYmICFyLmF0dGRCb2F0ICYmICFyLmF0dGROb25lKTtcclxuICAgICAgICAgIHIuZXJyQXR0ZEJhZENvbWJvID0gKHIuYXR0ZE5vbmUgJiYgKHIuYXR0ZFJlY2VwdGlvbiB8fCByLmF0dGRCb2F0KSk7XHJcbiAgICAgICAgICBpc0FsbFZhbGlkID0gaXNGb3JtVmFsaWQgJiYgIXIuZXJyQXR0ZE5vdFNlbGVjdGVkICYmICFyLmVyckF0dGRCYWRDb21ibztcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKGlzQWxsVmFsaWQpIHtcclxuICAgICAgICAkc2NvcGUuaXNTdWJtaXRTdWNjZXNzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgdmFyIGFjdGl2ZVJzdnBzID0gXy5maWx0ZXIoJHNjb3BlLnJzdnBzLCBmdW5jdGlvbihyKSB7XHJcbiAgICAgICAgICByZXR1cm4gci5pc0FjdGl2ZTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBfLmVhY2goYWN0aXZlUnN2cHMsIGZ1bmN0aW9uKHIpIHtcclxuICAgICAgICAgIC8vIFRoZSBzdWJtaXR0ZXIncyBpbmZvcm1hdGlvbiBpcyBpbiB0aGUgZmlyc3QgUlNWUCBmb3JtXHJcbiAgICAgICAgICByLnN1Ym1pdHRlckVtYWlsID0gYWN0aXZlUnN2cHNbMF0uZW1haWw7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRsb2cuZGVidWcoSlNPTi5zdHJpbmdpZnkoYWN0aXZlUnN2cHMpKTtcclxuXHJcbiAgICAgICAgJGh0dHAucG9zdChhcHBDb25maWcuYXBpVXJsICsgJy9yc3ZwcycsIGFjdGl2ZVJzdnBzKS5cclxuICAgICAgICAgIHN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICBzaW1wbGVNb2RhbHNTdmMub3BlblNpbXBsZU1vZGFsKFwiU3VjY2VzcyFcIiwgXCJXZSd2ZSByZWNlaXZlZCB5b3VyIFJTVlAuIFRoYW5rcyBmb3IgcmVzcG9uZGluZyFcIiwgXCJzbVwiKVxyXG4gICAgICAgICAgICAgIC5yZXN1bHQudGhlbihmdW5jdGlvbiAoc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIiMvaG9tZVwiO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJGxvZy5kZWJ1ZyhcInJzdnAgcG9zdCByZXBseTogXCIgKyBKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICAgICAgICB9KS5cclxuICAgICAgICAgIGVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cykge1xyXG4gICAgICAgICAgICBlcnJvckhhbmRsaW5nU3ZjLmhhbmRsZUh0dHBFcnJvcihcInN1Ym1pdHRpbmcgeW91ciBSU1ZQXCIsIHN0YXR1cyk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNldERlZmF1bHRzKCkge1xyXG4gICAgICAkc2NvcGUuaXNGUyA9IGZhbHNlO1xyXG4gICAgICAkc2NvcGUuaXNTdWJtaXRTdWNjZXNzID0gZmFsc2U7XHJcblxyXG4gICAgICAkc2NvcGUuZGlubmVyTWVudSA9IHtcclxuICAgICAgICAnU3VuLWRyaWVkIFRvbWF0byBDaGlja2VuJzogJ1N1bi1kcmllZCBUb21hdG8sIEFydGljaG9rZSAmIEJhc2lsIFN0dWZmZWQgQ2hpY2tlbiBCcmVhc3QsIEdvbGRlbiBXaGlwcGVkIE1hc2hlZCBQb3RhdG9lcywgQmFieSBWZWdldGFibGVzLCBhbmQgYSBCYWxzYW1pYyBSZWR1Y3Rpb24nLFxyXG4gICAgICAgICdGaWxldCBNaWdub24nOiAnU2VhIFNhbHQgUm9zZW1hcnkgRW5jcnVzdGVkIEZpbGV0IE1pZ25vbiwgVHJ1ZmZsZSBSb2FzdGVkIEZpbmdlcmxpbmcgUG90YXRvZXMgYW5kIEdyaWxsZWQgQXNwYXJhZ3VzJyxcclxuICAgICAgICAnU3BpbmFjaCAmIFBvcnRhYmVsbGEgTXVzaHJvb20nOiAnSmFzbWluZSBSaWNlIFRvcHBlZCB3aXRoIGEgR2FybGljIGFuZCBTcGluYWNoIFNhdXRlLCBHcmlsbGVkIFN1bW1lciBWZWdldGFibGVzIGFuZCBQb3J0YWJlbGxhIE11c2hyb29tIGFuZCBkcml6emxlZCB3aXRoIEJhbHNhbWljIEdsYXplIGFuZCBCYXNpbCBPaWwnXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAkc2NvcGUuZGlubmVyQ2hvaWNlcyA9IE9iamVjdC5rZXlzKCRzY29wZS5kaW5uZXJNZW51KTtcclxuXHJcbiAgICAgICRsb2cuZGVidWcoT2JqZWN0LmtleXMoJHNjb3BlLmRpbm5lck1lbnUpKTtcclxuXHJcbiAgICAgIC8vIERlZmF1bHQgdmFsdWVzXHJcbiAgICAgIHZhciByc3ZwU2VsZiA9IHt9O1xyXG4gICAgICByc3ZwU2VsZi5ndWVzdFR5cGUgPSBcInNlbGZcIjtcclxuICAgICAgcnN2cFNlbGYuaXNBY3RpdmUgPSB0cnVlO1xyXG5cclxuICAgICAgdmFyIHJzdnBHdWVzdCA9IHt9O1xyXG4gICAgICByc3ZwR3Vlc3QuZ3Vlc3RUeXBlID0gXCJndWVzdFwiO1xyXG4gICAgICByc3ZwR3Vlc3QuaXNBY3RpdmUgPSBmYWxzZTtcclxuXHJcbiAgICAgICRzY29wZS5yc3ZwcyA9IFtyc3ZwU2VsZiwgcnN2cEd1ZXN0XTtcclxuXHJcbiAgICAgIF8uZWFjaCgkc2NvcGUucnN2cHMsIGZ1bmN0aW9uKHIpIHtcclxuICAgICAgICByLmRpbm5lciA9ICcnO1xyXG4gICAgICAgIHIuZGVzc2VydCA9ICcnO1xyXG4gICAgICAgIHIuYXR0ZFJlY2VwdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgIHIuYXR0ZEJvYXQgPSBmYWxzZTtcclxuICAgICAgICByLmF0dGROb25lID0gZmFsc2U7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufSkoKTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWlrZSBvbiAxMC8zMS8yMDE1LlxyXG4gKi9cclxuXHJcbihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ3dlZGRpbmdBcHAnKVxyXG4gICAgLmZhY3RvcnkoJ2Vycm9ySGFuZGxpbmdTdmMnLCBlcnJvckhhbmRsaW5nU3ZjKTtcclxuXHJcbiAgZXJyb3JIYW5kbGluZ1N2Yy4kaW5qZWN0ID0gWyckbG9nJywgJ3NpbXBsZU1vZGFsc1N2YyddO1xyXG5cclxuICBmdW5jdGlvbiBlcnJvckhhbmRsaW5nU3ZjKCRsb2csIHNpbXBsZU1vZGFsc1N2Yykge1xyXG4gICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgIGhhbmRsZUh0dHBFcnJvcjogaGFuZGxlSHR0cEVycm9yXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgZnVuY3Rpb24gaGFuZGxlSHR0cEVycm9yKGVycm9yQ29udGV4dCwgc3RhdHVzQ29kZSkge1xyXG4gICAgICAkbG9nLmRlYnVnKGZvcm1hdChcIkh0dHAgZXJyb3Igb2NjdXJyZWQuIGNvbnRleHQ9ezB9LCBzdGF0dXNDb2RlPXsxfVwiLCBlcnJvckNvbnRleHQsIHN0YXR1c0NvZGUpKTtcclxuICAgICAgcmV0dXJuIHNpbXBsZU1vZGFsc1N2Yy5vcGVuU2ltcGxlRXJyb3JNb2RhbChlcnJvckNvbnRleHQpO1xyXG4gICAgfVxyXG4gIH1cclxufSkoKTtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgTWlrZSBvbiAxMS84LzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnd2VkZGluZ0FwcCcpXHJcbiAgICAuY29udHJvbGxlcignU2ltcGxlTW9kYWxDdHJsJywgU2ltcGxlTW9kYWxDdHJsKTtcclxuXHJcbiAgU2ltcGxlTW9kYWxDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckbW9kYWxJbnN0YW5jZScsICd0aXRsZScsICdtZXNzYWdlJ107XHJcblxyXG4gIGZ1bmN0aW9uIFNpbXBsZU1vZGFsQ3RybCgkc2NvcGUsICRtb2RhbEluc3RhbmNlLCB0aXRsZSwgbWVzc2FnZSkge1xyXG4gICAgJHNjb3BlLnRpdGxlID0gdGl0bGU7XHJcbiAgICAkc2NvcGUubWVzc2FnZSA9IG1lc3NhZ2U7XHJcblxyXG4gICAgJHNjb3BlLm9rID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgnb2snKTtcclxuICAgIH07XHJcbiAgfVxyXG59KSgpO1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBNaWtlIG9uIDEwLzMxLzIwMTUuXHJcbiAqL1xyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnd2VkZGluZ0FwcCcpXHJcbiAgICAuZmFjdG9yeSgnc2ltcGxlTW9kYWxzU3ZjJywgc2ltcGxlTW9kYWxzU3ZjKTtcclxuXHJcbiAgc2ltcGxlTW9kYWxzU3ZjLiRpbmplY3QgPSBbJyRtb2RhbCddO1xyXG5cclxuICBmdW5jdGlvbiBzaW1wbGVNb2RhbHNTdmMoJG1vZGFsKSB7XHJcbiAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgb3BlblNpbXBsZU1vZGFsOiBvcGVuU2ltcGxlTW9kYWwsXHJcbiAgICAgIG9wZW5TaW1wbGVFcnJvck1vZGFsOiBvcGVuU2ltcGxlRXJyb3JNb2RhbCxcclxuICAgICAgb3BlblVuc2VudEVycm9yTW9kYWw6IG9wZW5VbnNlbnRFcnJvck1vZGFsXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgZnVuY3Rpb24gb3BlblNpbXBsZU1vZGFsKHRpdGxlLCBtZXNzYWdlLCB3aW5kb3dTaXplKSB7XHJcbiAgICAgIHJldHVybiAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdzaW1wbGUtb2stbW9kYWwuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogJ1NpbXBsZU1vZGFsQ3RybCcsXHJcbiAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgIHNpemU6IHdpbmRvd1NpemUsXHJcbiAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgdGl0bGU6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGl0bGU7IH0sXHJcbiAgICAgICAgICBtZXNzYWdlOiBmdW5jdGlvbigpIHsgcmV0dXJuIG1lc3NhZ2U7IH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIG9wZW5TaW1wbGVFcnJvck1vZGFsKGVycm9yQ29udGV4dCkge1xyXG4gICAgICByZXR1cm4gb3BlblNpbXBsZU1vZGFsKFwiVWggb2ghXCIsIFwiU29ycnksIHNvbWV0aGluZyB3ZW50IHdyb25nIG9uIG91ciBzaWRlIFwiICsgZXJyb3JDb250ZXh0ICsgXCIuIFdlJ2xsIGJlIGxvb2tpbmcgaW50byB0aGUgcHJvYmxlbSAtIHBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCIsIFwibWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gb3BlblVuc2VudEVycm9yTW9kYWwoZXJyb3JDb250ZXh0KSB7XHJcbiAgICAgIHJldHVybiBvcGVuU2ltcGxlTW9kYWwoXCJVaCBvaCFcIiwgXCJJdCBsb29rcyBsaWtlIHNvbWV0aGluZyB3ZW50IHdyb25nIFwiICsgZXJyb3JDb250ZXh0ICsgXCIgLSB0aGUgaW5mb3JtYXRpb24gY291bGQgbm90IGJlIHNlbnQuIFBsZWFzZSBjaGVjayB5b3VyIGludGVybmV0IGNvbm5lY3Rpb24gb3IgdHJ5IGEgZGlmZmVyZW50IGJyb3dzZXIuXCIsIFwibWRcIik7XHJcbiAgICB9XHJcbiAgfVxyXG59KSgpO1xyXG4iLCIvKlxyXG4gKiBTb3VyY2U6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTQ5Njg2OTAvc2VuZGluZy1ldmVudC13aGVuLWFuZ3VsYXItanMtZmluaXNoZWQtbG9hZGluZ1xyXG4gKiBBdXRob3I6IHRydXNrdHJcclxuICovXHJcblxyXG4vKlxyXG4gKiBUaGUgd2hlblJlYWR5IGRpcmVjdGl2ZSBhbGxvd3MgeW91IHRvIGV4ZWN1dGUgdGhlIGNvbnRlbnQgb2YgYSB3aGVuLXJlYWR5XHJcbiAqIGF0dHJpYnV0ZSBhZnRlciB0aGUgZWxlbWVudCBpcyByZWFkeSAoaS5lLiBkb25lIGxvYWRpbmcgYWxsIHN1YiBkaXJlY3RpdmVzIGFuZCBET01cclxuICogY29udGVudCBleGNlcHQgZm9yIHRoaW5ncyB0aGF0IGxvYWQgYXN5bmNocm9ub3VzbHkgbGlrZSBwYXJ0aWFscyBhbmQgaW1hZ2VzKS5cclxuICpcclxuICogRXhlY3V0ZSBtdWx0aXBsZSBleHByZXNzaW9ucyBieSBkZWxpbWl0aW5nIHRoZW0gd2l0aCBhIHNlbWktY29sb24uIElmIHRoZXJlXHJcbiAqIGlzIG1vcmUgdGhhbiBvbmUgZXhwcmVzc2lvbiwgYW5kIHRoZSBsYXN0IGV4cHJlc3Npb24gZXZhbHVhdGVzIHRvIHRydWUsIHRoZW5cclxuICogYWxsIGV4cHJlc3Npb25zIHByaW9yIHdpbGwgYmUgZXZhbHVhdGVkIGFmdGVyIGFsbCB0ZXh0IG5vZGVzIGluIHRoZSBlbGVtZW50XHJcbiAqIGhhdmUgYmVlbiBpbnRlcnBvbGF0ZWQgKGkuZS4ge3twbGFjZWhvbGRlcnN9fSByZXBsYWNlZCB3aXRoIGFjdHVhbCB2YWx1ZXMpLiBcclxuICpcclxuICogQ2F2ZWF0czogaWYgb3RoZXIgZGlyZWN0aXZlcyBleGlzdHMgb24gdGhlIHNhbWUgZWxlbWVudCBhcyB0aGlzIGRpcmVjdGl2ZVxyXG4gKiBhbmQgZGVzdHJveSB0aGUgZWxlbWVudCB0aHVzIHByZXZlbnRpbmcgb3RoZXIgZGlyZWN0aXZlcyBmcm9tIGxvYWRpbmcsIHVzaW5nXHJcbiAqIHRoaXMgZGlyZWN0aXZlIHdvbid0IHdvcmsuIFRoZSBvcHRpbWFsIHdheSB0byB1c2UgdGhpcyBpcyB0byBwdXQgdGhpc1xyXG4gKiBkaXJlY3RpdmUgb24gYW4gb3V0ZXIgZWxlbWVudC5cclxuICovXHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCd3ZWRkaW5nQXBwJylcclxuICAgIC5kaXJlY3RpdmUoJ3doZW5SZWFkeScsIFsnJGludGVycG9sYXRlJywgZnVuY3Rpb24oJGludGVycG9sYXRlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICBwcmlvcml0eTogTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVIsIC8vIGV4ZWN1dGUgbGFzdCwgYWZ0ZXIgYWxsIG90aGVyIGRpcmVjdGl2ZXMgaWYgYW55LlxyXG4gICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50LCAkYXR0cmlidXRlcykge1xyXG4gICAgICAgIHZhciBleHByZXNzaW9ucyA9ICRhdHRyaWJ1dGVzLndoZW5SZWFkeS5zcGxpdCgnOycpO1xyXG4gICAgICAgIHZhciB3YWl0Rm9ySW50ZXJwb2xhdGlvbiA9IGZhbHNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBldmFsRXhwcmVzc2lvbnMoZXhwcmVzc2lvbnMpIHtcclxuICAgICAgICAgIGV4cHJlc3Npb25zLmZvckVhY2goZnVuY3Rpb24oZXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgICAkc2NvcGUuJGV2YWwoZXhwcmVzc2lvbik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgkYXR0cmlidXRlcy53aGVuUmVhZHkudHJpbSgpLmxlbmd0aCA9PSAwKSB7IHJldHVybjsgfVxyXG5cclxuICAgICAgICBpZiAoZXhwcmVzc2lvbnMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgaWYgKCRzY29wZS4kZXZhbChleHByZXNzaW9ucy5wb3AoKSkpIHtcclxuICAgICAgICAgICAgd2FpdEZvckludGVycG9sYXRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHdhaXRGb3JJbnRlcnBvbGF0aW9uKSB7XHJcbiAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gY2hlY2tJZkludGVycG9sYXRlZCgpIHtcclxuICAgICAgICAgICAgaWYgKCRlbGVtZW50LnRleHQoKS5pbmRleE9mKCRpbnRlcnBvbGF0ZS5zdGFydFN5bWJvbCgpKSA+PSAwKSB7IC8vIGlmIHRoZSB0ZXh0IHN0aWxsIGhhcyB7e3BsYWNlaG9sZGVyc319XHJcbiAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNoZWNrSWZJbnRlcnBvbGF0ZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIGV2YWxFeHByZXNzaW9ucyhleHByZXNzaW9ucyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGV2YWxFeHByZXNzaW9ucyhleHByZXNzaW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1dKTtcclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCd3ZWRkaW5nQXBwJylcclxuICAgIC5jb250cm9sbGVyKCdOYXZDdHJsJywgTmF2Q3RybCk7XHJcblxyXG4gIE5hdkN0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJ2NhcnRTdmMnXTtcclxuXHJcbiAgZnVuY3Rpb24gTmF2Q3RybCgkc2NvcGUsIGNhcnRTdmMpIHtcclxuICAgIGNhcnRTdmMubG9hZENhcnRJdGVtcygpO1xyXG4gICAgJHNjb3BlLmNhcnQgPSBjYXJ0U3ZjLmdldENhcnQoKTtcclxuXHJcbiAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCkgeyByZXR1cm4gJHNjb3BlLmNhcnQuaXRlbXM7IH0sIGZ1bmN0aW9uKCkge1xyXG4gICAgICB1cGRhdGVDYXJ0SXRlbUNvdW50KCk7XHJcbiAgICAgIHVwZGF0ZUlzQ2FydENvdW50ZXJWaXNpYmxlKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkc2NvcGUudGFicyA9IFtcclxuICAgICAgeyBwYXRoOiBcIiMvaG9tZVwiLCBsYWJlbDogXCJIb21lXCIgfSxcclxuICAgICAgeyBwYXRoOiBcIiMvdmVudWVcIiwgbGFiZWw6IFwiVmVudWVcIiB9LFxyXG4gICAgICB7IHBhdGg6IFwiIy9yc3ZwXCIsIGxhYmVsOiBcIlJTVlBcIiB9LFxyXG4gICAgICB7IHBhdGg6IFwiIy9ob3RlbHNcIiwgbGFiZWw6IFwiSG90ZWxzXCIgfSxcclxuICAgICAgeyBwYXRoOiBcIiMvcmVnaXN0cnlcIiwgbGFiZWw6IFwiUmVnaXN0cnlcIiB9LFxyXG4gICAgICB7IHBhdGg6IFwiIy9jYXJ0XCIsIGxhYmVsOiBcIlwiIH1cclxuICAgIF07XHJcblxyXG4gICAgZnVuY3Rpb24gdXBkYXRlQ2FydEl0ZW1Db3VudCgpIHtcclxuICAgICAgJHNjb3BlLmNhcnRJdGVtQ291bnQgPSAkc2NvcGUuY2FydC5pdGVtcy5sZW5ndGg7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdXBkYXRlSXNDYXJ0Q291bnRlclZpc2libGUoKSB7XHJcbiAgICAgICRzY29wZS5pc0NhcnRDb3VudGVyVmlzaWJsZSA9ICgkc2NvcGUuY2FydC5pdGVtcy5sZW5ndGggPiAwKTtcclxuICAgIH1cclxuICB9XHJcbn0pKCk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
